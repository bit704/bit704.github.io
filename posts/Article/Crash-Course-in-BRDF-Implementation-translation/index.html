

<!DOCTYPE html>
<html lang="zh-CN-spec" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="https://bit704.oss-cn-beijing.aliyuncs.com/image/2023-10-17-logo.png">
  <link rel="icon" href="https://bit704.oss-cn-beijing.aliyuncs.com/image/2023-10-17-logo.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="bit704">
  <meta name="keywords" content="blog">
  
    <meta name="description" content="BRDF实现速成课">
<meta property="og:type" content="article">
<meta property="og:title" content="Crash Course in BRDF Implementation【译】">
<meta property="og:url" content="https://reddish.fun/posts/Article/Crash-Course-in-BRDF-Implementation-translation/index.html">
<meta property="og:site_name" content="Homeworld">
<meta property="og:description" content="BRDF实现速成课">
<meta property="og:locale">
<meta property="article:published_time" content="2024-01-12T05:52:44.207Z">
<meta property="article:modified_time" content="2024-01-17T17:11:39.222Z">
<meta property="article:author" content="bit704">
<meta property="article:tag" content="CG">
<meta name="twitter:card" content="summary_large_image">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>Crash Course in BRDF Implementation【译】 - Homeworld</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"reddish.fun","root":"/","version":"1.9.4","typing":{"enable":true,"typeSpeed":50,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 65vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>逝者如斯夫！不舍昼夜。</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                <span>联系我</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button"
                 data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="iconfont icon-link-fill"></i>
                <span>更多</span>
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                
                  
                  
                  
                  <a class="dropdown-item" href="/links/">
                    
                    <span>相关链接</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="https://reddish.fun/posts/Article/additional/">
                    
                    <span>一些说明</span>
                  </a>
                
              </div>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('https://bit704.oss-cn-beijing.aliyuncs.com/image/2022-11-15-spaceplane.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="Crash Course in BRDF Implementation【译】"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-01-12 13:52" pubdate>
          2024年1月12日 下午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          <!-- compatible with older versions-->
          32k 字
        
      </span>
    

    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">Crash Course in BRDF Implementation【译】</h1>
            
            
              <div class="markdown-body">
                
                <p>BRDF实现速成课</p>
<span id="more"></span>
<p><a target="_blank" rel="noopener" href="https://boksajak.github.io/blog/BRDF">Crash Course in BRDF
Implementation</a></p>
<p>by Jakub Boksansky</p>
<p class="note note-primary">
个人翻译并注释。
</p>
<p><img
src="https://bit704.oss-cn-beijing.aliyuncs.com/image/2024-01-10-Figure_1.jpg" srcset="/img/loading.gif" lazyload /></p>
<p><em>图1 使用本博文描述的BRDF的BEEPLE
Zero-Day场景渲染结果<sup><a class=n href="#ref1">[1]</a></sup>。使用Falcor路径追踪器<sup><a class=n href="#ref2">[2]</a></sup>，每像素两百万条光线。</em></p>
<h1 id="introduction">1 Introduction</h1>
<p>创造逼真的材质模型作为计算机图形学研究的一个主题已经有几十年了。多年来已经提出了许多模型——经验模型、基于物理的模型、基于物理表面测量数据的模型。早期的经验模型，例如Phong或Lambertian，在利用有限的计算资源求值的同时提供合理的结果。它们长盛不衰的关键之一是能够合理地再现一系列真实世界的材质，提供直观的参数供美工调整（而不是物理单位）。</p>
<p>用于有效求解场景中光传输的算法的进步，例如路径追踪、光子映射和其他方法，使我们能够基于光在有大量表面的场景中的多重交互求解复杂材质，同时隐式渲染焦散（caustics）、间接（全局）照明、软阴影等效果。光传输算法负责建立光在场景中传播的路径，材质模型则计算光如何与沿路径的表面相互作用。这种方法的形式模型由著名的渲染方程<sup><a class=n href="#ref3">[3]</a></sup>描述，其中表面上材质的贡献由BRDF给出。</p>
<blockquote>
<p>光栅化方法需要显示渲染焦散、间接（全局）照明、软阴影等效果。</p>
</blockquote>
<p>本文中，我们将探讨游戏中常用的一些基本BRDF的实现及其背后的理论。许多现有的BRDF代码都经过高度优化，使用了许多近似和技巧，使其难以理解和修改。为了更容易研究现有的实现，我们提供了带有内部工作原理解释和全部已讨论BRDF的推导的代码。我们还将讨论BRDF在间接照明中的使用，例如蒙特卡罗路径追踪，其中需要重要性采样及确保能量守恒。这些通常不在游戏引擎中实现，因为光栅化不需要，但对于使用新兴实时光线追踪的应用程序来说是必需的。</p>
<h1 id="so-what-is-the-brdf">2 So, what is the BRDF?</h1>
<p>BRDF描述了给定入射光和出射光方向组合下的表面反射率（reflectance）。换句话说，它决定了当一定量的光从另一个方向入射时，有多少光在给定方向上反射，具体取决于表面的属性。例如，对于漫反射表面，BRDF指定在所有方向上都有少量反射，而对于镜子，所有光都在一个方向上反射。这个公式非常灵活，因为它使我们能够将表面材质的响应封装到BRDF实现及其参数设置中，独立于光传输的底层算法。注意，BRDF不区分直接和间接入射光，意味着它可用于计算场景中放置的虚拟光（局部照明）和从其他表面反射一次或多次的间接光（全局照明）的贡献。这也意味着BRDF独立于光照的实现，可以单独开发和编辑（BRDF只需要知道入射光的方向及其在着色点的强度）。
<span class="math display">\[
L(P,\omega_o)=L_e+\int_{\Omega} \boldsymbol{f(P,\omega_i,\omega_o)}
L_i(P,\omega_i)(\omega_i\cdot\hat{n}_p) d\omega_i
\]</span> <em>图2
渲染方程，BRDF以粗体高亮标记（这里使用latex公式，非图）</em></p>
<p>渲染算法和光照的独立性意味着我们可以将这种抽象的BRDF实现为“材质插件”，可以通过简单API访问，并且不同渲染器产生的视觉结果将相同。这导致了受技术美术人员青睐的材质库（如MDL<sup><a class=n href="#ref4">[4]</a></sup>）和通用材质创作工具（如Substance
Designer）的出现。材质也可以独立于渲染算法进行研究和开发。</p>
<p>为了使这种抽象发挥作用，并使BRDF基于物理（逼真），BRDF应遵循以下原则：</p>
<ul>
<li><strong>Helmholtz互易性</strong>：入射和出射方向可以交换（因此称为双向），并且所得的反射率相同。注意，某些算法会跟踪来自相机的光线（路径跟踪），某些算法会跟踪来自光源的光线（光子映射），或两者均有（双向路径跟踪）。Helmholtz互易性确保所有类型的算法得到一致的结果。</li>
<li><strong>能量守恒</strong>：从表面反射的能量应等于接收到的能量（对于具有完美白色反照率（albedo）且无吸收的表面）</li>
</ul>
<p>像Phong这样的早期经验模型通常不能满足这些要求，因此不适合真实感渲染。它们也无法正确再现许多材质的行为，如粗糙表面或金属，我们将在稍后更详细地讨论。一旦可编程且足够强大的GPU出现，从经验模型到基于物理模型的转变就会被推动，甚至对于实时渲染也是如此。</p>
<p>必须指出，一些成功的模型并不满足这些要求。
Disney模型<sup><a class=n href="#ref5">[5]</a></sup>不是能量守恒的（但他们的后续文章<sup><a class=n href="#ref6">[6]</a></sup>讨论了以后的项目的能量守恒），Autodesk模型<sup><a class=n href="#ref7">[7]</a></sup>不一定满足Helmholtz互易性。迪士尼模型与单向路径追踪结合使用，缺乏互易性不会带来严重问题。完美的能量守恒也可能不是一个严格的要求，因为除非BRDF反射的能量多于它接收的能量，否则不太可能造成问题，除了能量损失的表面会变暗之外。最后，BRDF实现的高性能和美工的易用性可能比满足
BRDF 的所有理论要求更可取，尤其是在渲染内容完全受控时。</p>
<h2 id="construction-of-brdf">2.1 Construction of BRDF</h2>
<p>游戏中使用的大多数BRDF由两个BRDF组成：漫反射（diffuse）波瓣和镜面反射（specular）波瓣。这种分解来自这样一个事实：当光与表面相互作用时，部分光被反射走（镜面反射BRDF），其余部分则散射到表面中。在材质内部，会发生更多的次表面散射，部分光最终再次集中表面并以随机方向离开材质（漫反射BRDF）。由于表面内部的散射，这种光被“过滤”并导致物体呈现出某一颜色。这也意味着光可以在表面下传播一段距离，将光带离入口点，从而产生“次表面散射”效果。常见的简化方法是忽略这种现象并将退出点设置为等于进入点。我们不会在本文中详细讨论次表面散射，推荐Pettineo<sup><a class=n href="#ref8">[8]</a></sup>最近发表的一篇博文，该文提供了有关这个主题的精彩总结。</p>
<p><img
src="https://bit704.oss-cn-beijing.aliyuncs.com/image/2024-01-10-Figure_3.jpg" srcset="/img/loading.gif" lazyload /></p>
<p><em>图3
分解为漫反射（左）和镜面反射（右）波瓣。BRDF值以蓝色显示，余弦加权BRDF贡献以红色显示（散射能量/离开辐射贡献）。</em></p>
<p>早在1924年，Pokrowski<sup><a class=n href="#ref9">[9]</a></sup>就在光学文献中讨论了镜面反射和漫反射的分解。注意BRDF值（蓝色）和余弦加权的散射能量（红色）之间的重要区别。余弦项来自渲染方程，将在第3.1节中进一步讨论，但对于详细解释，我们推荐Graphics
Codex<sup><a class=n href="#ref10">[10]</a></sup>中有关材质的章节。</p>
<p>菲涅尔（Fresnel）方程描述了有多少光反射走（或散射进）材质。在掠射角下入射的光更有可能被反射，产生有时称为“菲涅耳反射”的效果（见图4）。菲涅耳项还负责对金属（metal）和电介质（dielectric）之间的区别进行建模。金属的吸收系数比电介质高得多，这意味着部分本来会反射的光被吸收了。由于这种吸收取决于波长，某些金属（例如金）的反射颜色取决于各个波长的吸收方式，而电介质的反射通常会呈现不变的光源颜色。关于菲涅耳项的更多细节将在4.3节中讨论。</p>
<p><img
src="https://bit704.oss-cn-beijing.aliyuncs.com/image/2024-01-10-Figure_4.jpg" srcset="/img/loading.gif" lazyload /></p>
<p><em>图4 静止水面上的“菲涅尔反射”</em></p>
<p>注意，由于贡献漫反射BRDF的光已两次穿过材质边界，从技术上讲我们也应该应用菲涅耳项两次，但通常会创建漫反射BRDF来解决此问题。</p>
<p>我们已经提到，光在离开之前会在表面下传播一段距离，从而产生次表面散射效应。这假设行进的距离相对较短，并且光通过它进入的相同（或非常相似）的表面射出。然而，对于全透明或半透明材质，光可以穿过物体并从另一侧射出。更复杂的是，材质内部和/或粗糙表面的散射会导致光扩散（以随机方向传播，如通过磨砂玻璃、冰……）。透明度和次表面散射都可以使用“体积光传输”方法来渲染，该方法模拟光在体积内的传播方式。这些方法通常代价很高昂，其效果可以使用以下方法来近似：</p>
<ul>
<li><strong>BTDF</strong>（Transmittance）：描述光线如何通过表面传输到另一侧（在物体边界上）的函数，由Jos
Stam提出<sup><a class=n href="#ref11">[11]</a></sup>。</li>
<li><strong>参与介质</strong>（Participating
media）：由于光穿过物体而发生的简单消光。</li>
<li><strong>次表面散射算法</strong>：计算入射光的近似出口点。</li>
</ul>
<p>注意，BTDF仅描述表面边界上的透射率，而不描述对象内部的透射率。光仅在进入和离开体积的点处与材质相互作用，就好像网格是空心壳一样（实际上，这就是网格的建模方式），忽略了介质内部可能发生的散射。在这种情况下，必须显式应用可能发生的消光。</p>
<p>到目前为止，我们已经讨论了BRDF和BTDF来描述光的反射和透射，但文献中还常见一个总称“双向散射分布函数”（BSDF或BxDF），表示BRDF、BTDF、BSSRDF等。</p>
<p>最后，我们所有的BSDF（镜面反射BRDF、漫反射BRDF和BTDF）必须以有意义的方式组合，最关心的是能量守恒，我们将在5.1节中讨论。</p>
<h1 id="implementing-simple-brdfs">3 Implementing simple BRDFs</h1>
<p>本节中，我们将描述众所周知的简单
BRDF——Lambertian、Phong等。我们还将定义一个接口，使我们能够实现更复杂的BRDF作为直接替代品。开始前，让我们借助图5定义一些常用的向量。</p>
<p>向量<span
class="math inline">\(N\)</span>是给定表面的着色法线（可能来自法线贴图）。向量<span
class="math inline">\(V\)</span>，视线矢量，指定从着色点到观察者（相机）的方向。更一般地说，它指定出射光方向，在典型的路径追踪器中，这与光线方向相反。矢量<span
class="math inline">\(L\)</span>指向光源，或者指定入射光线反射的方向（根据上下文）。向量<span
class="math inline">\(H\)</span>是位于<span
class="math inline">\(V\)</span>和<span
class="math inline">\(L\)</span>之间的半向量。它也等于第4节中讨论的微面模型的微表面法线。向量<span
class="math inline">\(R\)</span>是向量<span
class="math inline">\(L\)</span>沿法线<span
class="math inline">\(N\)</span>的完美（镜面）反射方向，向量<span
class="math inline">\(T\)</span>是三角形平面上垂直于<span
class="math inline">\(N\)</span>的切线。所有这些向量都被标准化。向量<span
class="math inline">\(v\)</span>和<span
class="math inline">\(l\)</span>是<span
class="math inline">\(V\)</span>和<span
class="math inline">\(L\)</span>在三角形平面上的投影。</p>
<p><img
src="https://bit704.oss-cn-beijing.aliyuncs.com/image/2024-01-10-Figure_5.jpg" srcset="/img/loading.gif" lazyload /></p>
<p><em>图5 BRDF求值常用的向量</em></p>
<h2 id="lambertian-diffuse-brdf">3.1 Lambertian diffuse BRDF</h2>
<p>Lambertian函数是用于漫反射项的最简单的BRDF函数之一，假设入射光在所有可能的方向上均匀散射（在表面法线周围的半球内），但它仍然是许多现实世界材质的行为的良好近似，求解速度非常快。因此，对于次级光弹射（与合适的镜面反射BRDF结合），它可能是一个不错的选择。它也是UE4引擎中使用的默认漫反射BRDF<sup><a class=n href="#ref12">[12]</a></sup>。它不依赖于视线，因此对于涉及带有重投影的时间累积的算法（去噪、TAA
等）很友好。对于从第一原理开始的完整推导，Saikia写了一篇很好的文章<sup><a class=n href="#ref13">[13]</a></sup>，在这里我们将从Lambertian
BRDF的定义开始：</p>
<blockquote>
<p>次级光即secondary
light，指来自被直接光照射的物体的散射光。直接光即primary light。</p>
<p>Saikia文章地址：<a
target="_blank" rel="noopener" href="https://sakibsaikia.github.io/graphics/2019/09/10/Deriving-Lambertian-BRDF-From-First-Principles.html">Deriving
Lambertian BRDF from first principles</a></p>
</blockquote>
<p><span class="math display">\[
f_{Lambertian}(L,V)=\frac{diffuse\_reflectance}{\pi}
\]</span></p>
<p>计算来自已知方向<span
class="math inline">\(L\)</span>（例如一个虚拟光源）并向观察者反射的光很直接：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c++">brdfLambertian = (diffuseReflectance / PI) * <span class="hljs-built_in">dot</span>(N, L);<br></code></pre></td></tr></table></figure>
<p>通过这个，我们实现了BRDF接口的函数，称为<strong>eval</strong>。注意，我们已将余弦项从渲染方程（图
2）移至求解函数。这是一种常见的做法，因为在某些情况下，它可以与BRDF中使用的另一个余弦项抵消。此类实现有时被称为“<strong>内置余弦项的BRDF</strong>”，必须注意不要再次应用它。漫反射率（通常用符号<span
class="math inline">\(\rho\)</span>表示）指定有多少入射光在漫射波瓣中反射，通常根据“基色”（base
color）参数计算得出，我们将在第4.3.1节中讨论该参数。有时也使用术语反照率（albedo），该术语可能含糊不清，因为反照率（定义为入射光和反射光的比率）可能取决于方向，尽管实践中它通常被指定为法向入射方向。</p>
<p>另一种常见的优化是将除以常数<span
class="math inline">\(\pi\)</span>移至预处理步骤，离线预划分漫反射纹理。但是，所有使用基色的函数都必须进行相应调整，其中一些函数可能不包含除以<span
class="math inline">\(\pi\)</span>的内容。另一种选择是预划分光强度（intensity），但对于光可能来自多次弹射的路径跟踪并不适用。为了让事情不那么混乱，我们在代码示例中的BRDF包含除以<span
class="math inline">\(\pi\)</span>的内容。关于这个主题的深入讨论可以在Lagarde的文章“to
PI or not to PI”中找到<sup><a class=n href="#ref14">[14]</a></sup>。</p>
<p>目前为止，我们可以使用eval函数计算来自已知方向的光的BRDF贡献。对于大多数光传输算法（如蒙特卡罗路径追踪），需要另一个函数来确定我们应该在哪个方向追踪下一条光线。我们将此函数称为<strong>sample</strong>。它将采用一个随机数作为参数，并返回<strong>新的射线方向</strong>和<strong>概率密度函数
(PDF)
的值</strong>，后者可以理解为选择该特定方向而不是其他可能方向的可能性。看看PDF在蒙特卡洛估计器中是如何使用的：
<span class="math display">\[
F=\frac{f(x)}{pdf(x)}
\]</span></p>
<p>将<span class="math inline">\(f(L,V)\)</span>替换为Lambertian
BRDF得： <span class="math display">\[
I=\frac{f_{Lambertian}(L,V)}{pdf(L)}
\]</span></p>
<p><span class="math display">\[
I=\frac{\frac{diffuse\_reflectance}{\pi}(N\cdot L)}{pdf(L)}
\]</span></p>
<p>我们将值<span
class="math inline">\(I\)</span>称为采样权重，将在下一段中介绍它。
pdf的值取决于采样方法，并且它的选择可以是任意的，只要当BRDF非零时其PDF为正且非零即可。从最后一个方程可以看出，通过巧妙选择采样函数，它的PDF可以抵消一些BRDF项并简化计算。最基本的采样方法是在<strong>余弦加权半球</strong>中采样，<span
class="math inline">\(PDF=\frac{N \cdot
L}{\pi}\)</span>，这实际上是Lambertian和其他漫反射BRDF的极好选择。该采样方法的代码可以在Ray
Tracing Gems<sup><a class=n href="#ref15">[15]</a></sup>的 Sampling
Transformations
Zoo中找到，并在我们的代码示例中使用。这些方法通常通过在圆盘（disk）中生成一个随机点（通过扭曲两个随机数将正方形变形为圆盘）并将该点向上投影到半球上（仅通过计算Z分量）来工作。</p>
<p>为了展示PDF和BRDF项如何相互抵消，用余弦加权PDF代替得： <span
class="math display">\[
I=\frac{\frac{diffuse\_reflectance}{\pi}(N\cdot L)}{\frac{N \cdot
L}{\pi}}
\]</span></p>
<p><span class="math display">\[
I=diffuse\_reflectance
\]</span></p>
<p>现在可以看出将余弦项从渲染方程移至BRDF求解中如何使其与<span
class="math inline">\(\pi\)</span>一起被PDF抵消，以使最终方程中仅保留反射率。当使用蒙特卡罗积分时，例如在路径追踪中，该值很有用，我们将其称为采样权重。当光线击中表面时，我们根据BRDF对反射光线的方向进行采样，该光线可以“携带”的光量必须通过该权重进行调整，以考虑表面的材质属性。</p>
<p>这种用与BRDF紧密匹配的PDF构建采样函数的方法不仅简化了代码，而且还减少了蒙特卡洛估计器的方差（噪声），因此是
BRDF
实现的一个重要方面。这种方法的一个很好的例子是使用VNDF（可见法线分布）进行采样，将在4.4节中讨论。</p>
<p>使用这些，我们现在创建了一个称为<strong>evalIndirect</strong>的优化函数，它将eval和sample组合成一个函数，返回采样方向及其权重。注意，它还消除了真实PDF的计算，这对于某些算法（例如多重重要性采样）仍然有用。为了解决这个问题，我们引入了名为<strong>pdf</strong>的新方法，它只返回采样给定方向的PDF。为了验证我们优化的evalIndirect返回的结果是否与sample和pdf一致，我们总是可以通过显式调用eval和pdf来实现evalIndirect，并检查值<span
class="math inline">\(\frac{eval}{pdf}\)</span>是否等于优化的evalIndirect函数的采样权重。</p>
<p>这4个函数定义了任何BRDF的接口，因此我们可以通过实现这些函数轻松实现不同的材质类型，并为不同的光传输算法重用代码。总结如下：</p>
<ul>
<li><strong>eval</strong>：对于已知的入射和出射方向求解BRDF</li>
<li><strong>sample</strong>：采样BRDF以返回新的出射光线方向</li>
<li><strong>pdf</strong>：返回采样给定出射方向的PDF值</li>
<li><strong>evalIndirect</strong>：组合这些函数到一个优化版本中</li>
</ul>
<h2 id="phong-reflection-model">3.2 Phong Reflection Model</h2>
<p>过去常与Lambertian一起使用的另一种流行的反射模型由Phong提出<sup><a class=n href="#ref16">[16]</a></sup>，为实时渲染（他将其定义为&gt;30FPS的渲染）提供了计算成本低廉的镜面反射高光。<strong>不要将Phong反射模型和Phong着色相混淆</strong>——Phong着色是一种用于实现平滑镜面反射高光的法线插值方法。虽然Phong最初的论文指出，他的反射模型是基于物理的（通过观察真实材质得到），但按照今天的标准它并不是基于物理的，因为它缺乏非镜面反射峰值（off-specular
peak）、菲涅耳反射等现象。它的公式实现起来很简单（注意<span
class="math inline">\((N \cdot
L)\)</span>是按照与Lambertian相同的方式添加到代码中的术语）：</p>
<p><span class="math display">\[
f_{Phong}(L,V)=specular\_reflectance(R\cdot V)^{shininess}
\]</span></p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs glsl">brdfPhong = specularReflectance * <span class="hljs-built_in">pow</span>(<span class="hljs-built_in">dot</span>(R, V), shininess) * <span class="hljs-built_in">dot</span>(N, L);<br></code></pre></td></tr></table></figure>
<blockquote>
<p>Phong着色为逐像素计算光照，Gouraud着色为逐顶点计算光照。</p>
</blockquote>
<p>高光的宽度由指数（通常称为shininess或shine）控制，这是一个无界参数，但通常将其范围限制在10000左右。为了求解Phong模型，我们必须计算向量<span
class="math inline">\(R\)</span>(向量<span
class="math inline">\(L\)</span>沿法线反射），但正如Blinn在其优化版本<sup><a class=n href="#ref17">[17]</a></sup>中所示，可以使用半向量<span
class="math inline">\(H\)</span>代替。为了在我们的代码中实现sample函数，我们使用了Ray
Tracing Gems<sup><a class=n href="#ref15">[15]</a></sup>中的方法。</p>
<blockquote>
<p>Phong指数的典型取值：</p>
<p>10——"eggshell"</p>
<p>100——mildly shiny</p>
<p>1000——really glossy</p>
<p>10,000——nearly mirror-like</p>
<p>来自图形学虎书第五版</p>
</blockquote>
<p>由于它既不能量守恒也不互易，因此将其称为这种形式的称为“Phong
BRDF”在技术上是不正确的，但是，已经有人尝试修复这些缺陷并使其适合路径跟踪。Lafortune<sup><a class=n href="#ref18">[18]</a></sup>和Lawrence<sup><a class=n href="#ref19">[19]</a></sup>的文章展示了此类解决方案，包括重要性采样。人们已经创建了各种归一化项来使Phong模型能量守恒（例如，参见Giesen的文章<sup><a class=n href="#ref20">[20]</a></sup>）。Blinn推出了一个优化版本<sup><a class=n href="#ref17">[17]</a></sup>，并将Phong的镜面反射高光与Lambertian漫反射和恒定环境（ambient）项相结合，创建了Blinn-Phong反射模型，该模型成为实时应用程序的标准，直到被更先进的基于物理的模型所取代。目前，大多数已过时的旨在解释间接照明的环境项已被基于图像的照明、实时光线追踪或类似方法所取代。</p>
<p>Ashikhmin和Shirley<sup><a class=n href="#ref21">[21]</a></sup>提出了基于Phong反射的最全面的模型之一，其特点是能量守恒的互易BRDF、各向异性反射，并与合适的漫反射BRDF和重要采样方法相结合。最近，Goanda<sup><a class=n href="#ref22">[22]</a></sup>提出了另一种基于Phong的模型，该模型为了低计算成本进行了高度优化。Gotanda后来还推出了他的模型的改进分层版本<sup><a class=n href="#ref23">[23]</a></sup>。</p>
<h2 id="oren-nayar-diffuse-reflectance-model">3.3 Oren-Nayar Diffuse
Reflectance Model</h2>
<p>Oren和Nayar<sup><a class=n href="#ref24">[24]</a></sup>提出了更先进的漫反射模型，该模型考虑了表面粗糙度。他们的模型基于这样的观察：当视线方向接近入射光方向时，粗糙表面反射的光比Lambertian模型预测的要多（这种效应称为反向散射（backscattering），这种非Lambertian表面的一个例子是月球）。Oren-Nayar模型通过推广朗伯模型并使其对表面粗糙度和视线方向敏感来解释这种现象。它是使用微面（microfacet）理论推导出来的，就和下一节将讨论的基于物理的镜面反射模型一样。</p>
<p>注意，当该模型与镜面反射BRDF结合使用时，底层的微面模型和分布函数可能不同（Oren-Nayar使用具有高斯斜率分布（Gaussian
distribution of
slopes）的V-cavity模型），并且粗糙度参数可能需要从一个到另一个转换或重新映射到合理的范围。由于Oren-Nayar模型中的粗糙度（表示为<span
class="math inline">\(\sigma\)</span>）被定义为微面方向角的标准差，因此以角度单位指定。Lagarde关于Frostbite<sup><a class=n href="#ref25">[25]</a></sup>的文章中的附录B建议的将Beckmann粗糙度和Oren
Nayar粗糙度之间的转换为：</p>
<p><span class="math display">\[
roughness_{OrenNayar}=\frac{1}{\sqrt{2}}\arctan(roughness_{Beckmann})
\]</span>
Oren和Nayar提出了他们模型的几个版本，并进行了不同程度的简化。本文附带的代码使用最简单的“定性(qualitative)”模型：
<span class="math display">\[
f_{OrenNayar}(L,V)=\frac{diffuse\_refelctance}{\pi}(N \cdot
L)(A+B\max(0,\cos(\varphi_v-\varphi_l))\sin\alpha\tan\beta)
\]</span></p>
<p><span class="math display">\[
A=1.0-0.5\frac{\sigma^2}{\sigma^2+0.33};B=0.45\frac{\sigma^2}{\sigma^2+0.09};\alpha=\max(\theta_l,\theta_v);\beta=\min(\theta_l,\theta_v)
\]</span></p>
<p><span class="math inline">\(\theta_l\)</span>和<span
class="math inline">\(\theta_v\)</span>是<span
class="math inline">\(N\)</span>和<span
class="math inline">\(L\)</span>、<span
class="math inline">\(V\)</span>之间的角，<span
class="math inline">\(\varphi_v\)</span>和<span
class="math inline">\(\varphi_l\)</span>是这些向量之间的方位角（azimuth）（它们在法线定义的平面上的投影之间的角度）。我们的代码示例计算这些向量到法线平面的投影以获得正确的角度，但优化版本也消除了一些三角函数的使用（以平方根为代价），可以在PBR<sup><a class=n href="#ref26">[26]</a></sup>中找到。</p>
<h2 id="disney-burley-diffuse-model">3.4 Disney (Burley) Diffuse
Model</h2>
<p>另一种流行且广泛使用的模型是Disney漫反射<sup><a class=n href="#ref5">[5]</a></sup>，有时也称为Burley漫反射。它是通过观察测量数据得出的经验模型，包括依赖于粗糙度的掠射逆反射（grazing
retroreflection）现象。在这方面，它类似于Oren
Nayar模型，但计算起来更简单。它基于Schlick的菲涅尔近似公式（参见第 4.3
节），并扩展了基本Lambertian模型，以根据粗糙度在指定范围（0.5到2.5）内增加或减少掠射角的反射率：
<span class="math display">\[
F_{D90}=0.5+2\ roughness\ \cos^2\theta_d
\]</span></p>
<p><span class="math display">\[
f_{Disney}(L,V)=\frac{diffuse\_refelctance}{\pi}(1+(F_{D90}-1)(1-\cos\theta_l)^5)(1+(F_{D90}-1)(1-\cos\theta_v)^5)
\]</span></p>
<p>由于该模型不是使用微面理论推导出的（与Oren-Nayar模型不同），此粗糙度参数没有与微面法线的统计分布相同的含义，并且可能与镜面反射BRDF使用的粗糙度不兼容。
Burley的论文建议将粗糙度重新映射为镜面反射BRDF粗糙度 (<span
class="math inline">\(\alpha\)</span>)，如下所示： <span
class="math display">\[
\alpha=roughness^2
\]</span>
此外，该模型能量不守恒，在能量守恒很重要的渲染器中使用可能会出现问题（如路径跟踪）。Lagarde在他关于Frostbite引擎渲染的优秀文章<sup><a class=n href="#ref25">[25]</a></sup>中描述了该模型的一个版本，该版本显著提高了能量守恒，确保反射的能量不会多于与基于GGX的镜面反射BRDF结合时接收到的能量。</p>
<h2 id="more-diffuse-brdfs">3.5 More diffuse BRDFs</h2>
<p><img
src="https://bit704.oss-cn-beijing.aliyuncs.com/image/2024-01-10-Figure_6.jpg" srcset="/img/loading.gif" lazyload /></p>
<p><em>图6 细微的差别。粗糙物体（粗糙度 =
0.5）上的漫反射BRDF的比较。从左到右：Lambertian、Oren-Nayar、Disney
diffuse、Frostbite diffuse。</em></p>
<p>本文未涉及的另一种值得研究的漫反射BRDF是Hanrahan-Krueger<sup><a class=n href="#ref27">[27]</a></sup>和Heitz-Dupuy<sup><a class=n href="#ref28f">[28]</a></sup>提出的。一个有趣的研究方向是寻找与广泛使用的基于GGX的微面BRDF良好结合的漫反射模型，以实现能量守恒和合理的视觉结果，例如Gotanda<sup><a class=n href="#ref29">[29]</a></sup>的工作中发现的模型。</p>
<h1 id="microfacet-model">4 Microfacet Model</h1>
<p>最近的许多BRDF都是基于微面理论的，该理论最初是在光学文献中提出，并在Blinn<sup><a class=n href="#ref17">[17]</a></sup>以及Cook和Torrance
<sup><a class=n href="#ref30">[30]</a></sup>的文章中引入到图形社区。微面模型的动机是为了更好地理解和模拟来自粗糙表面的光反射，如测量所示，这与简单的Lambertian和菲涅尔反射预测的结果不匹配。例如，微面理论解释了称为非镜面峰值的现象，当偏离完美反射方向的方向达到最大反射率时，就会发生这种现象，如Torrance和Sparrow<sup><a class=n href="#ref31">[31]</a></sup>所讨论的。</p>
<p>使用微面模型的BRDF通常被称为基于物理的，以表明它们是根据物理定律（光学）设计的，而不是根据观察经验进行设计的，尽管在计算机图形学中，我们经常使用简化和近似来使计算可行，并通过消除物理单位和参数使
BRDF更加实用。</p>
<p>这种简化的一个很好的例子是省略菲涅耳方程中使用的复杂折射率（index of
refraction）。有时，“物理合理”一词也用于描述行为与观察到的现实世界材质相同的模型，但不一定是使用光学定律导出的。对于实时渲染，我们通常还使用几何光学和RGB三元组来表示光，而不是波动光学和光谱分布。权衡是此类渲染器无法考虑薄膜干涉引起的衍射和光偏振等效应。</p>
<p><img
src="https://bit704.oss-cn-beijing.aliyuncs.com/image/2024-01-10-Figure_7.jpg" srcset="/img/loading.gif" lazyload /></p>
<p><em>图7
由许多<strong>微面</strong>（microfacet）组成的<strong>微表面</strong>（microsurface）（蓝色）。显示了一些选定微面的微表面法线<span
class="math inline">\(H\)</span>（红色）。几何表面及其法线<span
class="math inline">\(N\)</span>用灰色突出显示。注意，根据微表面模型，微表面本身不需要像该图像上的示例那样是连续的。</em></p>
<p>微面理论将表面建模为具有不同坡度和高度的微面的集合（见图
7）。微面变化的程度和方式由微面分布函数<span
class="math inline">\(D\)</span>描述（通常取决于粗糙度参数来控制表面外观）。这赋予了BRDF其形状，从而影响材质的最终外观。</p>
<p>通常，单个微面被假设为完美镜面，但任何BSDF也可以用于微面。注意，仅对几何表面进行建模，并且使用微面模型计算微面的效果，因此我们仅观察它们的聚合效果<sup id="fnref:1" class="footnote-ref"><a href="#fn:1" rel="footnote"><span
class="hint--top hint--rounded"
aria-label="但是Heitz发表了一篇有趣的论文，该论文以程序方式生成Beckmann分布表面的网格以用于研究目的[71]">[1]</span></a></sup>。</p>
<p>微面模型反射项定义为<sup><a class=n href="#ref30">[30]</a></sup><sup><a class=n href="#ref31">[31]</a></sup><sup><a class=n href="#ref32">[32]</a></sup>：
<span class="math display">\[
R=\frac{F(L,H)G(L,V,H)D(H)}{4(N \cdot L)(N \cdot V)}
\]</span> 其中<span class="math inline">\(N\)</span>是着色法线，<span
class="math inline">\(H\)</span>是指向<span
class="math inline">\(L\)</span>和<span
class="math inline">\(V\)</span>之间方向的半向量（<span
class="math inline">\(H=\|L+V\|\)</span>）。它也称为微表面法线、高光向量或半程向量，之前被
Blinn<sup><a class=n href="#ref17">[17]</a></sup>用于优化Phong着色计算。使用半向量的公式很方便，因为它也可以用于折射，如
Walter<sup><a class=n href="#ref32">[32]</a></sup>所描述的，以及通过生成与给定正态分布函数<span
class="math inline">\(D\)</span>相对应的半向量来进行重要性采样，我们将在稍后讨论。所有这些术语将在下面的部分中更详细地讨论，这里只是一个简短的总结：</p>
<ul>
<li><strong>D
Term</strong>：微面分布函数——告诉我们有多少微面面向方向<span
class="math inline">\(H\)</span>，以便从方向<span
class="math inline">\(L\)</span>入射的光沿方向<span
class="math inline">\(V\)</span>反射。</li>
<li><strong>F
Term</strong>：菲涅耳项，计算给定入射角下从表面反射的光量。</li>
<li><strong>G Term</strong>：几何衰减项（即本文后面的掩蔽和阴影（masking
and shadowing ）项<span class="math inline">\(G_2\)</span>
），解释了微面的相互阴影（和掩蔽），有时也用于BRDF的归一化。</li>
<li><strong>Denominator</strong>：来自使用完美镜面作为微面的微面模型的推导。注意，Cook和Torrance的原始论文<sup><a class=n href="#ref30">[30]</a></sup>在分母中使用常数<span
class="math inline">\(\pi\)</span>而不是4。
Walter指出<sup><a class=n href="#ref32">[32]</a></sup>这是由于<span
class="math inline">\(D\)</span>项的不同归一化造成的，并且最近的文献都同意使用常数4。</li>
</ul>
<h2 id="distribution-term">4.1 Distribution Term</h2>
<p>分布项<span class="math inline">\(D\)</span>使用微面normal
distribution function (NDF)，该函数计算微面的哪些部分面向方向<span
class="math inline">\(H\)</span>，以便从方向<span
class="math inline">\(L\)</span>入射的光沿方向<span
class="math inline">\(V\)</span>反射。换句话说，假设各个微面之间没有发生遮挡，给定的<span
class="math inline">\(L\)</span>和<span
class="math inline">\(V\)</span>方向之间可以反射多少光（下面讨论）。NDF不应与正态（即高斯）分布混淆，尽管它是NDF的可能实现之一（例如，由Torrance和Sparrow<sup><a class=n href="#ref31">[31]</a></sup>使用）。</p>
<p><img
src="https://bit704.oss-cn-beijing.aliyuncs.com/image/2024-01-10-Figure_8.png" srcset="/img/loading.gif" lazyload /></p>
<p><em>图8 GG-X分布的“Longer tail”，alpha值设为0.4。</em></p>
<p>在文献中可以找到各种分布函数。Beckmann
NDF是广泛应用于光学领域的一个例子，也广泛应用于计算机图形学领域。Beckmann分布使用指定为微面均方根
(RMS)
斜率的直观粗糙度参数来控制其形状。另一个重要的NDF是由Trowbridge和Reitz提出的<sup><a class=n href="#ref33">[33]</a></sup>，并由Blinn于1977年推荐<sup><a class=n href="#ref17">[17]</a></sup>。后来Walter将其重新推导为GG-X<sup id="fnref:2" class="footnote-ref"><a href="#fn:2" rel="footnote"><span
class="hint--top hint--rounded"
aria-label="GG-X可能是“Ground Glass - roughness unknown”的缩写[72]，以用于光学测量的抛光至一定粗糙度的磨砂玻璃板命名。">[2]</span></a></sup><sup><a class=n href="#ref32">[32]</a></sup>。虽然Trowbridge-Reitz分布与GG-X相同并且早于它，我们将在本文中使用更简单的GG-X公式。与Beckmann
NDF相比，它提供的镜面波瓣形状具有“Longer
tail”，这意味着镜面反射峰值的衰减更慢，如图8所示。这与许多测量的真实世界材质更接近，因此GG-X在游戏中广泛使用，但Pixar描述着色的论文<sup><a class=n href="#ref34">[34]</a></sup>中提到Beckmann分布仍然被使用。应该指出的是，由于图形社区贡献的许多优化和近似，GG-X的求解代价更小。</p>
<p>Beckmann分布定义为： <span class="math display">\[
D_{Beckmann}=\frac{e^{\frac{-\tan^2(\theta_h)}{\alpha^2}}}{\pi\alpha^2\cos^4\theta_h}
\]</span> <span
class="math inline">\(\theta_h\)</span>是法线和半向量的夹角，<span
class="math inline">\(\alpha\)</span>是粗糙度。<span
class="math inline">\(\alpha\)</span>和微面的RMS斜率<span
class="math inline">\(\sigma\)</span>的关系是：<span
class="math inline">\(\alpha=\sqrt{2\sigma}\)</span><sup><a class=n href="#ref26">[26]</a></sup>。作为一个优化，我们可以使用Hoffman的文章<sup><a class=n href="#ref35">[35]</a></sup>中提出的等价<span
class="math inline">\(\tan^2(\theta_h)=\frac{1-cos^2\theta_h}{cos^2\theta_h}\)</span>来消去正切函数，其中我们使用方便易得的<span
class="math inline">\(\theta_h\)</span>的余弦，通过<span
class="math inline">\(N \cdot H\)</span>就可计算： <span
class="math display">\[
D_{Beckmann}=\frac{e^{\frac{\cos^2\theta_h-1}{\alpha^2\cos^2\theta_h}}}{\pi\alpha^2\cos^4\theta_h}
\]</span> GG-X分布定义为： <span class="math display">\[
D_{GGX}=\frac{\alpha^2}{\pi\cos^4\theta_h(\alpha^2+tan^2(\theta_h))^2}
\]</span>
该公式还可以进一步简化<sup><a class=n href="#ref35">[35]</a></sup>。我们以与Beckmann分布相同的方式替换正切函数，并展开分母，然后可以将其表示为<span
class="math inline">\(((\alpha^2-1)\cos^2\theta_h+1)\)</span>平方。得到的优化公式为：
<span class="math display">\[
D_{GGX}=\frac{\alpha^2}{\pi((\alpha^2-1)\cos^2\theta_h+1)^2}
\]</span> 还有一个由Blinn使用Phong反射模型导出的NDF（称为Blinn-Phong
NDF）<sup><a class=n href="#ref17">[17]</a></sup>，并且在 Walter
的论文<sup><a class=n href="#ref32">[32]</a></sup>中也进行了讨论，他得出的结论是，对于某些粗糙度值，Beckmann和Blinn-Phong分布非常相似。这可以解释Phong着色模型的经久不衰，因为它能够准确地表示某些材质（尤其是塑料）。Walter
的论文<sup><a class=n href="#ref32">[32]</a></sup>中还提供了Beckmann粗糙度和Phong指数之间的近似转换公式（该论文还表明，对于0.2左右的粗糙度值，Phong分布与
Beckmann分布几乎相同）。今天它可能看起来已经过时，但在加载使用Phong指数的材质的旧模型时（如流行的OBJ格式）可能会很方便。
<span class="math display">\[
shininess=\frac{2}{\alpha^2}-2
\]</span></p>
<p><span class="math display">\[
\alpha=\sqrt{\frac{2}{shininess+2}}
\]</span></p>
<p>正如我们所看到的，每个模型的粗糙度单位可能有很大不同。Torrance和Sparrow以及Oren-Nayar模型直接使用正态分布的标准差，Beckmann和Trowbridge-Reitz使用斜率的统计均方根，而Burley使用在合理范围内根据经验选择的值。当多个BRDF耦合在一起时（通常是镜面反射和漫反射BRDF），将美工指定的粗糙度仔细转换为底层BRDF使用的粗糙度单位非常重要。这种转换的一个很好的例子可以在Disney的Principled
BRDF<sup><a class=n href="#ref5">[5]</a></sup>中找到。正如已经提到的，他们将粗糙度参数重新映射到用于镜面反射BRDF的<span
class="math inline">\(\alpha\)</span>作为该值的平方。这使得粗糙度的变化在感知上呈线性，并且与底层漫反射BRDF兼容，但在计算<span
class="math inline">\(D\)</span>和<span
class="math inline">\(G\)</span>项时必须注意再次对<span
class="math inline">\(\alpha\)</span>值进行平方（参见上面的公式）。或者，可以单独指定每个BRDF的粗糙度以实现更多的美术控制。</p>
<h2 id="geometric-attenuation-term">4.2 Geometric Attenuation Term</h2>
<p>几何衰减项𝐺解释了由于微表面的几何形状导致的反射光衰减（attenuation），这种衰减是在某些微面相互遮挡时发生的。它有时也用作BRDF的归一化项。正如Torrance和Sparrow<sup><a class=n href="#ref31">[31]</a></sup>所指出的，<span
class="math inline">\(G\)</span>项抵消了菲涅尔项，并且导致了某些粗糙度的材质当菲涅尔预测的高反射率因<span
class="math inline">\(G\)</span>项在掠射角处造成的显著阴影而减弱时出现的“非镜面峰值”，在更低角度处出现峰值反射率。</p>
<p>微表面的几何形状由用于建模其形状的轮廓（profile）给出。已经有两种重要的微表面轮廓：V-Cavity模型，假设微表面由一定宽度和高度的V形凹槽组成，以及基于斜率随机分布的Smith模型<sup><a class=n href="#ref36">[36]</a></sup>。Cook-Torrance和Oren-Nayar在他们的BRDF中使用了V-Cavity模型，但正如Heitz的一篇文章<sup><a class=n href="#ref37">[37]</a></sup>所示，Smith函数是使用这两个的正确模型，因此，本文中我们将只讨论Smith的<span
class="math inline">\(G\)</span>函数，定义为： <span
class="math display">\[
G_1(H,S)=\frac{1}{1+\lambda(a)}
\]</span></p>
<p><span class="math display">\[
a=\frac{(H \cdot S)}{\alpha\sqrt{1-(H \cdot S)^2}}
\]</span></p>
<p><span class="math inline">\(S\)</span>是<span
class="math inline">\(L\)</span>或者<span
class="math inline">\(V\)</span>向量，<span
class="math inline">\(H\)</span>是微面法线，<span
class="math inline">\(\lambda\)</span>是特定于所选NDF的函数。由给定NDF推导<span
class="math inline">\(\lambda\)</span>的过程在Brown的论文<sup><a class=n href="#ref38">[38]</a></sup>中描述，Walter<sup><a class=n href="#ref32">[32]</a></sup>和Heitz<sup><a class=n href="#ref37">[37]</a></sup>的论文中展示了各种NDF（Beckmann，GG-X，Blinn-Phong）的<span
class="math inline">\(\lambda\)</span>函数（和优化后的<span
class="math inline">\(G_1\)</span>项）： <span class="math display">\[
\lambda_{GGX}(a)=\frac{-1+\sqrt{1+\frac{1}{a^2}}}{2}
\]</span></p>
<p><span class="math display">\[
\lambda_{Beckmann}(a)=
\begin{cases}
  &amp; \frac{1-1.259a+0.396a^2}{3.535a+2.181a^2} &amp;,where\ a&lt;1.6
\\
  &amp; 0&amp;, where\ a\ge 1.6
\end{cases}
\]</span></p>
<p>在这里，我们展示了Walter<sup><a class=n href="#ref32">[32]</a></sup>导出的<span
class="math inline">\(\lambda_{Beckmann}\)</span>的有理逼近，而不是需要高昂计算误差函数的原始函数。通过将<span
class="math inline">\(\lambda\)</span>函数替换为通用<span
class="math inline">\(G_1\)</span>公式并简化表达式，可以针对特定NDF优化<span
class="math inline">\(G_1\)</span>的评估，如我们的代码示例中所做的那样。</p>
<p>Schlick<sup><a class=n href="#ref39">[39]</a></sup>提出了Beckmann分布的另一种常见有理近似，同一篇论文中出现了著名的Schlick菲涅尔近似。然而，他近似了不同版本的Smith
<span
class="math inline">\(G\)</span>函数<sup><a class=n href="#ref32">[32]</a></sup><sup><a class=n href="#ref35">[35]</a></sup><sup><a class=n href="#ref37">[37]</a></sup>，并不适合微面BRDF。</p>
<p><img
src="https://bit704.oss-cn-beijing.aliyuncs.com/image/2024-01-10-Figure_9.jpg" srcset="/img/loading.gif" lazyload /></p>
<p><em>图9
当入射光被<strong>微表面</strong>（microsurface）（蓝色）上的其他<strong>微面</strong>（microfacet）阻挡时，就会出现<strong>阴影</strong>（shadowing）（左）。当反射光被另一微面阻挡时发生<strong>掩蔽</strong>（masking）（右）。</em></p>
<p>发生几何衰减是因为许多微面可以以某种方式定向以反射给定方向下入射的光，但最终只有最接近光源的微面成功反射光（其他微面被阴影，如图9所示）。这同样适用于反射光，反射光在离开微表面时可能会被其他微面掩蔽。Smith的<span
class="math inline">\(G_1\)</span>函数可用于阴影<span
class="math inline">\(G_1(H,L)\)</span>和掩蔽<span
class="math inline">\(G_1(H,V)\)</span>，它们组合出掩蔽-阴影函数： <span
class="math display">\[
G_2=G_1(H,L)*G_1(H,V)
\]</span>
此组合公式假设遮蔽和阴影不相关，然而这是不准确的，因为微表面中更深的面被同时遮蔽和阴影的概率更高。这可以通过使用史密斯掩蔽-阴影函数的高度相关（height-correlated）形式解决：
<span class="math display">\[
G_2=\frac{1}{1+G_1(H,L)+G_1(H,V)}
\]</span> 任一形式的<span
class="math inline">\(G_2\)</span>都可以用于前面介绍的微面模型反射公式中的<span
class="math inline">\(G\)</span>项，但相关版本更可取，因为它只是稍微费一点计算并且更准确。Lagarde<sup><a class=n href="#ref25">[25]</a></sup>的工作中可以找到GG-X分布的高度相关<span
class="math inline">\(G_2\)</span>的显著优化实现。通过将GG-X分布的<span
class="math inline">\(G_1\)</span>项代入的公式并化简，我们得到的表达式包含可以方便地与微面模型的分母相抵消的项，从而使计算成本更低。Hammon<sup><a class=n href="#ref40">[40]</a></sup>提出了GG-X的另一个有趣的高度相关<span
class="math inline">\(G_2\)</span>近似，它的计算速度非常快，但会引入一些误差。对于Beckmann分布，我们的代码示例不提供此类优化而是直接计算所有项。</p>
<p>由于<span
class="math inline">\(G\)</span>项有效地指定了可见微面的比例，因此组合NDF和<span
class="math inline">\(G_1\)</span>项（<span class="math inline">\(D
\cdot
G_1\)</span>）给出了可见法线的分布<sup><a class=n href="#ref41">[41]</a></sup>，这是我们稍后将讨论的高效采样例程的基础。</p>
<p>到目前为止，我们假设被阴影或遮蔽的光会丢失，即使对于具有完全光滑微面的简化模型来说也是不正确的。这就是基于微面的BRDF发生能量损失的地方，不幸的是，微面之间的多重散射建模非常复杂且计算成本高昂，在实时渲染中通常被忽略。Heitz的论文<sup><a class=n href="#ref42">[42]</a></sup>、d’Eon的Hitchhiker’s
Guide<sup><a class=n href="#ref43">[43]</a></sup>以及Imageworks使用的技术<sup><a class=n href="#ref44">[44]</a></sup>（也在RTR<sup><a class=n href="#ref45">[45]</a></sup>中进行了讨论）详细介绍了该主题。</p>
<h3 id="anisotropic-materials">4.2.1 Anisotropic materials</h3>
<p>表现出各向异性反射的材质（例如拉丝金属）可以使用NDF的各向异性版本及其相应的几何项进行建模。关于这个主题的深入讨论可以在
Heitz<sup><a class=n href="#ref37">[37]</a></sup>和
Ward<sup><a class=n href="#ref46">[46]</a></sup>的论文中找到。这些函数的计算通常比较复杂，并且由二元粗糙度值（两个垂直方向的不同粗糙度）控制。必须在切线空间中进行计算，以确保整个网格上各向异性镜面高光的方向正确且一致。关于Disney
Principled
BRDF的文章<sup><a class=n href="#ref5">[5]</a></sup>展示了使用附加的各向异性参数的直观参数化（在文章最新版本的附录中）。这与标准粗糙度参数结合使用来计算合理范围内的2D粗糙度。</p>
<p>PBR第543页<sup><a class=n href="#ref26">[26]</a></sup>中建议的更简单的解决方案是仍然使用NDF和<span
class="math inline">\(G\)</span>项的各向同性版本，但根据各向异性高光发生的方向调整粗糙度值。</p>
<h2 id="fresnel-term">4.3 Fresnel Term</h2>
<p>菲涅耳项<span
class="math inline">\(F\)</span>决定了有多少光将从表面反射，有效地告诉我们有多少光将用于计算BRDF。剩余部分<span
class="math inline">\(1-F\)</span>将传递到底层材质层（如漫反射BRDF或透射BTDF）。到目前为止，我们的实现仅讨论了两层（镜面反射和漫反射），但可以创建具有多个层的复杂材质。菲涅耳项应在光从一层传播到另一层的每个界面上进行计算。为简单起见，各个层的厚度通常为零，但可以结合光谱渲染对一些厚度进行建模，当层界面比穿过它的光的波长薄时产生衍射（diffraction）（虹彩（iridescence））等效果。为了进一步讨论分层材质，我们推荐Autodesk的文章<sup><a class=n href="#ref7">[7]</a></sup>和Jakob等人<sup><a class=n href="#ref47">[47]</a></sup>、Weidlich和Wilkie<sup><a class=n href="#ref48">[48]</a></sup>的作品。对于实现虹彩，Belcour和Parla最近发表的论文很有趣<sup><a class=n href="#ref49">[49]</a></sup>。</p>
<p>菲涅耳项取决于视线方向、表面法线、材料属性（折射率和消光系数），并由相对复杂的菲涅耳方程表示，但该方程也考虑了光的偏振。菲涅耳项对于掠射角始终接近统一，这意味着所有光都会被反射，尽管对于中间角度，如Cook和Torrance<sup><a class=n href="#ref30">[30]</a></sup>所讨论的那样，会发生“color
shift”。</p>
<p>Christophe
Schlick引入了一种广泛使用的菲涅尔近似值，用于计算机图形学<sup><a class=n href="#ref39">[39]</a></sup>。正如他指出的那样，完整的菲涅尔方程不仅计算成本昂贵，而且依赖于不直观的折射率<span
class="math inline">\(n\)</span>和消光<span
class="math inline">\(k\)</span>，这不符合我们对可预测且易用的参数的需求。更复杂的是，完整的折射率是一个由实部（折射率）和虚部（消光系数）组成的复数，并且是按波长指定的。这不适合使用RGB三元组进行渲染。Naty
Hoffman题为“被认为有害的菲涅尔方程”的文章<sup><a class=n href="#ref50">[50]</a></sup>对该主题进行了进一步讨论，并得出结论除非使用光谱渲染完整的菲涅尔方程并不比Schlick近似更精确。</p>
<p>Schlick近似使用这样的观察结果：在90度下观察时，所有材质都表现出完美的反射率，并且我们可以仅使用一个参数——法线入射（0度——<span
class="math inline">\(F_0\)</span>）下的表面反射率来近似完整的菲涅尔方程：</p>
<p><span class="math display">\[
F=F_0+(F_{90}-F_0)*(1-u^5)
\]</span> 其中<span
class="math inline">\(u\)</span>是法线与视线方向之间角度的余弦 （<span
class="math inline">\(u=N \cdot V\)</span>），并且<span
class="math inline">\(F_{90}\)</span>等于
1，除了下节讨论的情况。注意，折射率和消光系数已被去掉，但我们现在需要指定法线入射时的反射率<span
class="math inline">\(F_{0}\)</span>。使用Schlick公式的另一个结果是着色无法解释光的偏振。Mojzik等人在该领域完成了一项有趣的工作<sup><a class=n href="#ref51">[51]</a></sup>。</p>
<h3 id="specifying-reflectance-at-normal-incidence">4.3.1 Specifying
reflectance at normal incidence</h3>
<p>消除<span class="math inline">\(n\)</span>和<span
class="math inline">\(k\)</span>简化了计算，但也导致失去对材质是否表现为电介质（低吸收系数——塑料、木材等）或导体（高吸收系数——铜、金等）的控制。这些之间的差异最好通过金属反射的色调（color
tint）来观察（因为部分光谱被吸收），而电介质的反射则接手光源的不变颜色。正如Cook和Torrance<sup><a class=n href="#ref30">[30]</a></sup>所指出的，金属反射是根据法线入射（表示为<span
class="math inline">\(F_{0}\)</span>，有时也表示为<span
class="math inline">\(R_{F0}\)</span>）的材质的基色着色的。利用这些知识，我们可以通过引入一个称为金属度<sup><a class=n href="#ref52">[52]</a></sup>（metalness）的参数来“修复”金属菲涅尔反射的颜色，该参数将<span
class="math inline">\(F_{0}\)</span>作为电介质的默认反射率和金属的基色之间的混合计算<sup><a class=n href="#ref53">[53]</a></sup>：
<span class="math display">\[
F_0=lerp(F_{0Dielectricss},base\_color,metalness)
\]</span> <span
class="math inline">\(F_{0Dielectricss}\)</span>的一个常用值是0.04（4%反射率），UE4<sup><a class=n href="#ref12">[12]</a></sup>和Frostbite<sup><a class=n href="#ref25">[25]</a></sup>均用此值。一些现实世界材质的反射率甚至更低，水为2%，但某些电介质材质的反射率也可能更高，钻石为0.18<sup><a class=n href="#ref35">[35]</a></sup>。该值不会随材质而变化，在渲染器中是固定的，其选择对最终外观有重大影响。金属度还会减弱金属的漫反射率<sup><a class=n href="#ref30">[30]</a></sup><sup><a class=n href="#ref52">[52]</a></sup>，这是根据基色计算得出的：
<span class="math display">\[
diffuse\_reflectance=base\_color*(1-metalness)
\]</span></p>
<p>这个参数组合（基色和金属度）有时称为金属度工作流，并且具有限制性，无法为漫反射和镜面反射设置不同的色相（color
hue）。另一种方法是镜面工作流，它可以直接指定漫反射和镜面反射率<sup><a class=n href="#ref54">[54]</a></sup>，而不是根据基色计算它。它需要更多的存储空间，但可以创建更广泛的材质，包括具有显著不同的漫反射和镜面反射率的非真实材料，从而提供更大的美术自由。</p>
<blockquote>
<p>Schlick近似求<span class="math inline">\(F_0\)</span>公式：</p>
<p><span class="math display">\[
F_0=(\frac{n1-n2}{n1+n2})^2
\]</span></p>
<p>空气折射率为1，取塑料折射率为1.5： <span class="math display">\[
F_0=(\frac{1.5-1}{1.5+1})^2=0.04
\]</span> 取水的折射率为1.33，同理可求得<span
class="math inline">\(F_0=0.02\)</span>。</p>
<p>Metallic/Roughness工作流和Specular/Glossiness工作流对应的材质贴图不同。</p>
<table>

<thead>
<tr class="header">
<th>Metallic/Roughness工作流</th>
<th>Specular/Glossiness工作流</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Base Color贴图<br/>（三通道）<br/>（对于金属存<span
class="math inline">\(F_0\)</span>，对于电介质存漫反射颜色（此时<span
class="math inline">\(F_0\)</span>设为0.04），混合材质可以认为同时存了这两种数据）<br/>（除了微观遮蔽信息外不该含有任何光照信息）</td>
<td>Diffuse贴图<br/>（三通道）<br/>（对于金属存0，对于电介质存漫反射颜色）<br/>（除了微观遮蔽信息外不该含有任何光照信息）</td>
</tr>
<tr class="even">
<td>Metallic贴图<br/>（单通道，相当于图层遮罩）<br/>（0代表非金属，1代表纯金属，中间值代表锈蚀等中间状态）</td>
<td>Specular贴图<br/>（三通道）<br/>（存<span
class="math inline">\(F_0\)</span>）</td>
</tr>
<tr class="odd">
<td>Roughness<br/>（单通道）<br/>（0代表平滑，1代表粗糙）</td>
<td>Glossiness贴图<br/>（单通道）<br/>（0代表粗糙，1代表光滑）</td>
</tr>
</tbody>
</table>
<p>当贴图分辨率与纹素密度过小时，在金属与电介质交界产生白边（金属工作流）/
黑边（高光工作流）。</p>
<table>

<thead>
<tr class="header">
<th></th>
<th>Metallic/Roughness工作流</th>
<th>Specular/Glossiness工作流</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>优点</td>
<td>由于电介质的<span
class="math inline">\(F_0\)</span>规定为0.04，所以设计师在对其赋值时不易出错。如需调整，在大多实现流程中有控制器可以直接覆写这个值。<br/>内存需求小。<br/>兼容性广。</td>
<td>边缘效应不明显。<br/>可以在Specular贴图中自由调整电介质的<span
class="math inline">\(F_0\)</span>。</td>
</tr>
<tr class="even">
<td>缺点</td>
<td>边缘效应较明显。</td>
<td>自由调整电介质的<span
class="math inline">\(F_0\)</span>可能导致错误，打破能量守恒，渲染不正确。<br/>内存需求大。<br/>需要设计师了解PBR。</td>
</tr>
</tbody>
</table>
</blockquote>
<p>对于某些材质，可能需要对从<span
class="math inline">\(F_0\)</span>到1的过渡进行更多控制，以减少Schlick近似的误差。<span
class="math inline">\(F_0\)</span>的RGB值已针对法向入射进行测量或计算，但对于某些材质，中间角度的色相可能会略有不同（例如，某些金属和涂层表面），或者当我们想要创建非真实的材质——unobtainiums
。Gulbrandsen<sup><a class=n href="#ref55">[55]</a></sup>通过引入两个参数来控制反射率和他称为edge-tint的参数来解决这个问题。最近，Hoffman提供了一种改进的解决方案<sup><a class=n href="#ref50">[50]</a></sup>，通过引入表示为<span
class="math inline">\(h\)</span>的附加参数来控制edge-falloff，其中包括Lazanyi的误差项<sup><a class=n href="#ref56">[56]</a></sup>以减少Schlick的近似误差。<span
class="math inline">\(h\)</span>参数可以理解为<span
class="math inline">\(F_{82}\)</span><sup><a class=n href="#ref57">[57]</a></sup>——82度的反射率，可以使用真实解决方案进行计算，也可以针对给定材质进行测量。</p>
<p>注意，<span
class="math inline">\(F_0\)</span>最初取决于表面两侧的折射率，并且通常假设表面被空气包围。如果情况并非如此（例如，在水下），则应相应调整<span
class="math inline">\(F_0\)</span>（例如，参见RTR第324页<sup><a class=n href="#ref45">[45]</a></sup>）。</p>
<p>上述提到的Lazanyi的修复重新引入了<span
class="math inline">\(n\)</span>和<span
class="math inline">\(k\)</span>参数（但在Hoffman的解决方案中不需要）。如果需要，可以Polyanskiy<sup><a class=n href="#ref58">[58]</a></sup>创建的优秀数据库中找到各种材质的这些，但是仍然按波长指定。</p>
<p>Lagarde提出了对Schlick菲涅耳项的一个有趣的优化，它使用球面高斯近似<sup><a class=n href="#ref59">[59]</a></sup>，并已在UE4<sup><a class=n href="#ref12">[12]</a></sup>中使用：
<span class="math display">\[
F=F_0+(F_{90}-F_0)*2^{(-5.55473*u-6.983146)*u}
\]</span>
重要的实现细节是，菲涅尔项必须针对采样微面的法线（半向量）进行计算，而不是表面（或着色）法线，否则菲涅尔项基本上会忽略材料的粗糙度，并且物体会出现比实际情况更具反射性。</p>
<p>一个相关的问题来自于这样一个事实：法线贴图通常用于创建空洞、划痕或铜锈，美工会将底色变暗以减少这些特征的反射。由于菲涅尔项在90度时总是接近1，因此效果通常与美工的意图相反，并且空洞变得更具反射性，因为它们的法线与视线方向接近90度角。可能的解决方案之一是Schüler<sup><a class=n href="#ref60">[60]</a></sup>引入的修复，它可以防止菲涅耳项在某些条件下接近1。我们不设置<span
class="math inline">\(F_{90}=1\)</span>，而是将<span
class="math inline">\(F_{90}\)</span>计算为<span
class="math inline">\(F_{90}=min(1,60\
luminance(F_0))\)</span>。这会为反射率小于1/60的<span
class="math inline">\(F_0\)</span>值创建平滑但非常快速的从1开始的衰减。数字1/50或值<span
class="math inline">\(F_{0Dielectric}\)</span>的倒数也经常用在这个地方。我们知道现实世界中没有材质的反射率低于2%，因此这些低值可以被认为是为限制菲涅耳项而保留的。最后注意，当使用金属度计算<span
class="math inline">\(F_0\)</span>时，此方法不会产生任何效果，因为它是我们代码示例中默认的，因为没有<span
class="math inline">\(F_0\)</span>会小于<span
class="math inline">\(F_{0Dielectric}\)</span>
。为了完整性，我们在代码中提供了此修复，因为它对于使用不同方式计算<span
class="math inline">\(F_0\)</span>或由美工直接设置的情况非常有用。某些引擎提供的遮挡（occlusion）值可应用于镜面反射组件或用于Schüler的修复以获得类似的效果。注意当来自8位纹理时，只有少数<span
class="math inline">\(F_0\)</span>值会触发此修复。有关此主题的更多讨论可以在Hoffman的文章<sup><a class=n href="#ref61">[61]</a></sup>的末尾找到。</p>
<h2 id="sampling-the-microfacet-brdf">4.4 Sampling the microfacet
BRDF</h2>
<p>有了所有这些知识，我们现在可以实现微面镜面反射BRDF的eval函数，请参阅本文附带的代码示例以获取完整列表。</p>
<p>为了高效实现采样方法，我们需要一个例程，对使用选定的<span
class="math inline">\(D\)</span>和<span
class="math inline">\(G\)</span>函数构建的微面BRDF进行重要性采样。本文中我们使用Heitz提出的基于VNDF的采样<sup><a class=n href="#ref41">[41]</a></sup>，他还在另一篇文章<sup><a class=n href="#ref62">[62]</a></sup>中提供了针对GG-X分布采样的改进和优化版本。</p>
<p>此采样例程使用局部空间中指定的向量，其中正Z轴与着色法线对齐（与大多数采样函数一样）。因此，我们必须在采样之前将我们的视线向量变换到这个局部空间，并使用这种变换的逆变换将得到的光向量变换回来。注意，许多渲染器在切线空间中进行着色，例如由于法线贴图，这与VNDF采样的局部空间类似但不相同。虽然切线空间可以围绕几何法线构建，但我们的局部空间围绕着色法线。因此，对于已经在切线空间中指定的向量也需要进行额外的变换。</p>
<p>单位四元数是一种表示旋转的优雅方式，因为我们的目标是找到着色法线和标准基向量<span
class="math inline">\((0,0,1)\)</span>之间的旋转，所以这种四元数的构造可以显著简化。因此，我们使用四元数旋转将向量变换到VNDF局部空间并变换回来（通过简单地反转四元数的轴即可找到逆变换）。</p>
<p>为了获得采样方向的权重，我们必须计算BRDF除以该采样方法的PDF，如3.1节中所述。得益于VNDF采样的构造，BRDF的许多项与PDF的项相互抵消，得到的权重仅为<span
class="math inline">\(F*(\frac{G_2}{G_1(H,V)})\)</span>。<span
class="math inline">\(G_2\)</span>和<span
class="math inline">\(G_1\)</span>的分数可以仅使用<span
class="math inline">\(G_{1L}\)</span>和<span
class="math inline">\(G_{1V}\)</span>项重写，如Heitz关于漫发射BRDF的论文<sup><a class=n href="#ref28">[28]</a></sup>的附录所示。因为这里的向量<span
class="math inline">\(H\)</span>被构造为恰好在<span
class="math inline">\(L\)</span>和<span
class="math inline">\(V\)</span>之间，所以<span
class="math inline">\(G_{1L}\)</span>项等于<span
class="math inline">\(G_{1V}\)</span>项，我们可以像代码示例中那样进一步优化其计算。</p>
<p>VNDF采样的原始实现（在VNDF论文<sup><a class=n href="#ref41">[41]</a></sup>的补充材料中提供）依赖于初始化期间的预计算数据，正如Wenzel
Jakob<sup><a class=n href="#ref63">[63]</a></sup>所指出的，Beckmann分布的版本包含不连续性，这可能会在使用低差异序列（例如蓝噪声）时导致问题，或对于诸如Metropolis的光传输算法。Jakob的论文包含一种改进的方法，可以修复这些缺陷，包括代码。Walter<sup><a class=n href="#ref32">[32]</a></sup>提出了以前广泛使用的应该被提到的方法，但其效率低于VNDF，并且有生成可能具有非常大的采样权重的样本的不良特性，从而导致萤火虫（尽管对于Beckmann分布这可以使用“Walter’s
trick”部分缓解，通过将粗糙度调整为<span
class="math inline">\(\alpha^{’}=(1.2-0.2\sqrt{|N \cdot
L|})\alpha\)</span>）。</p>
<h1 id="combining-brdfs">5 Combining BRDFs</h1>
<p>本文中我们为了将镜面反射BRDF与漫反射BRDF结合起来，使用了一种基于菲涅耳项将镜面反射和漫反射BRDF混合在一起的简单方法。注意，微面模型已经用<span
class="math inline">\(F\)</span>衡量镜面BRDF的权重，因此我们还用<span
class="math inline">\((1-F)\)</span>衡量漫反射BRDF的权重。这是受到分层材料的启发，其中光与每一层相互作用，菲涅耳项用于计算有多少光从表面反射（有助于镜面波瓣）以及有多少散射到表面里（有助于下层，在我们的例子是漫反射波瓣）。使用这种方法，任意BRDF可以一起使用并组合成多层<sup><a class=n href="#ref48">[48]</a></sup>，例如，广泛使用的基于微面的GG-X镜面反射BRDF与Lambertian或Disney漫反射BRDF的组合。更复杂的多层材质通常使用一个或两个镜面波瓣（其中额外的镜面波瓣模拟基础表面顶部的透明涂层）、具有可选次表面散射的漫反射BRDF、用于透射的BTDF。注意，分层材质中的每个
BRDF 本身应该是能量守恒的。</p>
<p>注意，为了计算漫反射BRDF层，我们需要知道镜面反射BRDF层的菲涅耳项。在代码中，我们对镜面反射BRDF的半向量进行采样并将其用于菲涅耳项计算，即使仅计算漫反射项也是如此。这开销可能很大，因此使用近似归一化项或表格数据可能是更好的方法。</p>
<p>更正确但也更严格的解决方案是使用同时包含漫反射和镜面反射模型的模型，这些模型被设计为很好地协同工作，例如Ashikhmin-Shirley<sup><a class=n href="#ref21">[21]</a></sup>和Kelemen-Szirmay-Kalos<sup><a class=n href="#ref64">[64]</a></sup>的模型。另一种选择是选择偏爱的BRDF并找到合适的漫反射BRDF，然后将其简单地求和。这种方法的一个例子是Lagarde对Disney漫反射所做的修改<sup><a class=n href="#ref25">[25]</a></sup>。有关实践中使用的多层材质的更多信息，可参见关于《使命召唤》里的材质的演讲<sup><a class=n href="#ref65">[65]</a></sup>。</p>
<p>当组合多个BRDF时，所得的BRDF仍应遵循确保能量守恒和Helmholtz互易的基本原则，但这在实践中通常很难实现。</p>
<h2 id="energy-conservation">5.1 Energy Conservation</h2>
<p>引言部分中提到的BRDF必须遵守的基本原则之一是要求能量守恒——表面反射的光不应多于其接收的光。此外，如果表面是完美的反射器（白色反照率），也不会发生能量损失。在实践中，即使对于从微面模型导出的基于物理的BRDF，通常也会发生一些能量损失。能量损失的主要来源是缺乏微面之间的多次反射。</p>
<p>过去在构建用于实时渲染的材质模型时，能量守恒问题经常被忽视，特别是在仅使用单次弹射照明时。对于路径光线追踪和全局照明算法，重要的是要确保光线从表面反射时不会产生能量，否则无法保证路径追踪器的收敛。</p>
<p><img
src="https://bit704.oss-cn-beijing.aliyuncs.com/image/2024-01-10-Figure_10.jpg" srcset="/img/loading.gif" lazyload /></p>
<p><em>图10 White
furnace测试显示具有完美能量守恒的BRDF（左）和具有能量损失的BRDF（右）。</em></p>
<p>一个易于实施且实用的能量守恒测试测试是white
furnace测试<sup><a class=n href="#ref37">[37]</a></sup>，它是由各个方向的白光照射的白色球体的渲染结果。如果材质是能量守恒的，则球体将在白色背景下消失。任何差异都表明能量损失或增益（见图
10）。由于球体的渲染包含视线和光向量的所有可能配置，我们可以很好地了解能量增益或损失发生的角度。</p>
<h1 id="parametrizing-the-brdf">6 Parametrizing the BRDF</h1>
<p>在本节中，我们将总结所描述的BRDF参数如何与美工设置的材质属性相关。到目前为止，我们已经使用了以下参数：</p>
<ul>
<li>镜面反射BRDF
<ul>
<li>法向入射的镜面反射率<span class="math inline">\(F_0\)</span></li>
<li>82度角入射的镜面反射率<span
class="math inline">\(F_{82}\)</span>（可选）</li>
<li>粗糙度</li>
</ul></li>
<li>漫反射BRDF
<ul>
<li>漫反射率</li>
<li>粗糙度</li>
</ul></li>
</ul>
<p>所有这些参数都可以直接设置以获得更大的美术自由度（作为单个值或从纹理加载），或者使用已知值（测量的或预先计算的）对材质进行建模，但通常会限制可以为反射率和粗糙度设置的值以使指定物理上合理的材质变得更加容易，并使材质属性更加紧凑以便存储。</p>
<p>我们没有直接使用漫反射和镜面反射率，而是使用基色和金属度参数来计算它们，如4.3节中所述。这确保了物理上不可能的材质不容易创建，并且还使我们能够模拟电介质和金属之间的区别。粗糙度值直接指定并为镜面反射BRDF重新映射，与Disney
Principled BRDF中的方式相同（通过平方）。<span
class="math inline">\(F_{82}\)</span>仅与Hofmann改进的菲涅尔近似一起使用，对于改善具有已知<span
class="math inline">\(F_{82}\)</span>值的金属（例如铬或金）的外观特别有用。</p>
<h2 id="transmission">6.1 Transmission</h2>
<p>为了引入渲染半透明表面所需的透射效果，我们可以重用本文中已经讨论过的概念——即菲涅耳项、微面模型和分层材质。菲涅尔方程告诉我们有多少光被反射走并散射进表面，因此我们只需决定散射到内部的光的哪一部分将贡献给漫反射BRDF，而其余部分将贡献给BTDF。我们在材质模型中引入了一个新参数——漫反射概率或透射率（transmittance），它直接指定了有多少比例的散射光将分别贡献给漫反射BRDF和BTDF。注意，此参数与不透明度（opacity）不同，不透明度也会影响镜面反射BRDF，因为对于高透射率的材质我们在掠射角下仍然会得到菲涅耳反射，但零不透明度的物体则完全消失（无法影响镜面反射BRDF）。</p>
<p>光的透射部分可以根据Snell定律完美折射，也可以使用微面BTDF来创建粗糙折射，就像我们创造粗糙反射一样。Walter的论文<sup><a class=n href="#ref32">[32]</a></sup>对该方法进行了广泛的总结，所得的折射模型近似于微面反射项。</p>
<h1 id="code-sample">7 Code Sample</h1>
<p>本文附带的<a
target="_blank" rel="noopener" href="https://github.com/boksajak/brdf">代码示例</a>实现了所有讨论的BRDF。文件是用HLSL编写的，但也可以在C++环境中编译（添加支持HLSL类型和函数的库，例如GLM），并且可以轻松集成到光栅化器或路径跟踪器中。注意，可以针对将使用的所选BRDF组合进一步优化代码。</p>
<p>默认设置是基于GG-X的微面镜面反射BRDF与Lambertian漫反射BRDF的组合，它们经过高度优化并且可以很好地协同工作。可以通过调用evalCombinedBRDF来集成代码示例，以计算给定光源对给定点的贡献。evalIndirectCombinedBRDF根据所选BRDF（漫反射或镜面反射）采样新光线方向及其权重，以确定路径追踪器中下一条光线的方向。</p>
<h1 id="conclusion-and-further-reading">8 Conclusion and Further
Reading</h1>
<p>在电影和游戏的制作中，创建基于物理且合理的材质模型比完全真实的材质模型更为重要。这意味着模型不会（太多）违反物理定律，但也可以通过暴露直观且易于理解的参数来实现足够的美术控制，即使是以省略折射率等物理量为代价。</p>
<p>看看各个模型暴露了哪些参数（及其范围）是很有趣的。Brent
Burley</sup>撰写的一篇关于Disney Principled
BRDF的文章<sup><a class=n href="#ref5">[5]</a></sup>是一个很好的起点，其中讨论了参数、范围及其映射的选择，以及选择底层BRDF来构建成功的材质模型的技术决策。还有关于与MERL数据库中测量的现实世界材质进行比较的有趣讨论。它还提供了按时间顺序排列的值得研究的著名作品列表（但直到2012年他的论文发表为止），并且有一个
Github仓库<sup><a class=n href="#ref66">[66]</a></sup>，其中的代码可以免费获得。Burley于2015年发表了一篇后续文章<sup><a class=n href="#ref6">[6]</a></sup>，根据他们的模型的实际使用进行了更多改进。</p>
<p>对于游戏中使用的实现，有Lagarde
(Frostbite)<sup><a class=n href="#ref25">[25]</a></sup>、Karis
(Unreal)<sup><a class=n href="#ref12">[12]</a></sup>和 Lazarov (Call of
Duty)<sup><a class=n href="#ref67">[67]</a></sup>的出色作品。有趣的是能看出不同的开发人员对相同的问题得出不同的结论（例如，使用Lambertian还是Disney漫反射、选择GG-X还是Beckmann
NDF分布，等等），这表明这些问题没有单一的通用答案。</p>
<p>关于基于物理的BRDF的更深入的理论背景，可以学习RTR<sup><a class=n href="#ref45">[45]</a></sup>中的第9章（该章提供了更多相关工作的介绍）、PBR<sup><a class=n href="#ref26">[26]</a></sup>中的第8章和第9章、Background:
Physics and Math of
Shading<sup><a class=n href="#ref35">[35]</a></sup>（来自Naty
Hoffman）、Graphics
Codex<sup><a class=n href="#ref10">[10]</a></sup>、Eric
Heitz关于BRDF的著作。基于物理的着色课程网页包含大量供进一步研究的资源。Substance
PBR
guide<sup><a class=n href="#ref54">[54]</a></sup>也值得熟悉，以了解技术美术如何使用PBR材质。</p>
<p>关于电影制作和离线渲染中使用的BRDF，可以学习Burley<sup><a class=n href="#ref5">[5]</a></sup><sup><a class=n href="#ref6">[6]</a></sup>的文章、Arnold渲染器的描述<sup><a class=n href="#ref68">[68]</a></sup>
、Pixar的渲染<sup><a class=n href="#ref34">[34]</a></sup>以及Autodesk使用的材质<sup><a class=n href="#ref7">[7]</a></sup>。这些通常比游戏中使用的BRDF向美工公开更多的参数（例如清漆（clearcoat）和光泽（sheen）参数）。</p>
<p>由于计算机图形学学术界和工业界使用的BRDF和材质术语经常令人困惑，并且许多术语被互换使用或错误使用，我们建议阅读McGuire等人为渲染工程师撰写的BSDF波瓣分类法<sup><a class=n href="#ref69">[69]</a></sup>。</p>
<p>为了获得使用什么特定值来模拟不同种类金属的灵感，Jarrod
Hasenjager进行了一项精彩的材质研究<sup><a class=n href="#ref70">[70]</a></sup>。</p>
<p>另一个有趣的研究主题是开发专用BRDF来解决特定问题，例如皮肤、头发、纺织品、划痕表面、时变材质、水和许多其他特殊材质的渲染。</p>
<h1 id="references">9 References</h1>
<p><a name="ref1">[1] M. Winkelmann, "Zero-Day, Open Research Content
Archive (ORCA)," 2019. [Online]. Available:
https://developer.nvidia.com/orca/beeple-zero-day. </a></p>
<p><a name="ref2">[2] N. Benty, K.-H. Yao, P. Clarberg, L. Chen, S.
Kallweit, T. Foley, M. Oakes, C. Lavelle and C. Wyman, "The Falcor
Rendering Framework," 2020. [Online]. Available:
https://github.com/NVIDIAGameWorks/Falcor. </a></p>
<p><a name="ref3">[3] J. T. Kajiya, "The rendering equation,"
Proceedings of the 13th annual conference on Computer graphics and
interactive techniques, pp. pp. 143-150, 1986. </a></p>
<p><a name="ref4">[4] L. Kettner, M. Raab, D. Seibert, J. Jordan and A.
Keller, "The Material Definition Language," 2015. </a></p>
<p><a name="ref5">[5] B. Burley, "Physically Based Shading at Disney,"
2012. </a></p>
<p><a name="ref6">[6] B. Burley, "Extending the Disney BRDF to a BSDF
with," 2015. </a></p>
<p><a name="ref7">[7] I. Georgiev, J. Portsmouth, Z. Andersson, A.
Herubel, A. King, S. Ogaki and F. Servant, "Autodesk Standard Surface,"
2019. [Online]. Available: https://autodesk.github.io/standard-surface/.
</a></p>
<p><a name="ref8">[8] M. Pettineo, "An Introduction To Real-Time
Subsurface Scattering," 2019. [Online]. Available:
https://therealmjp.github.io/posts/sss-intro/.</a></p>
<p><a name="ref9">[9] G. I. Pokrowski, "Zur Theorie der diffusen
Lichtreflexion," pp. 66-72, 1924. </a></p>
<p><a name="ref10">[10] M. McGuire, "Graphics Codex," [Online].
Available: http://graphicscodex.com/. </a></p>
<p><a name="ref11">[11] J. Stam, "An illumination model for a skin layer
bounded by rough surfaces," in Rendering Techniques, 2001. </a></p>
<p><a name="ref12">[12] B. Karis, "Real shading in unreal engine 4," in
Proc. Physically Based Shading Theory Practice 4, 2013. </a></p>
<p><a name="ref13">[13] S. Saikia, "Deriving Lambertian BRDF from first
principles," 2019. </a></p>
<p><a name="ref14">[14] S. Lagarde, "PI or not to PI in game lighting
equation," 2012. </a></p>
<p><a name="ref15">[15] P. Shirley, S. Laine, D. Hart, M. Pharr, P.
Clarberg, E. Haines, M. Raab and D. Cline, "Sampling Transformations
Zoo," in Ray Tracing Gems, 2019. </a></p>
<p><a name="ref16">[16] B. Phong, "Illumination for computer generated
pictures," Communications of the ACM, 1975. </a></p>
<p><a name="ref17">[17] J. F. Blinn, "Models of light reflection for
computer synthesized pictures," in Proceedings of the 4th annual
conference on Computer graphics and interactive techniques, 1977.
</a></p>
<p><a name="ref18">[18] E. P. Lafortune and Y. D. Willems, "Using the
modified phong reflectance model for physically based rendering," 1994.
</a></p>
<p><a name="ref19">[19] J. Lawrence, "Importance Sampling of the Phong
Reflectance Model," 2008. </a></p>
<p><a name="ref20">[20] F. Giesen, "Phong Normalization Factor
derivation," 2009. </a></p>
<p><a name="ref21">[21] M. Ashikhmin and P. Shirley, "An anisotropic
phong BRDF model," Journal of graphics tools, 2000. </a></p>
<p><a name="ref22">[22] Y. Gotanda, "Physically Based Shading Models in
Film and Game Production: Practical Implementation at tri-Ace," 2010.
</a></p>
<p><a name="ref23">[23] Y. Gotanda, "Practical Physically Based Shading
in Film and Game Production: Beyond a Simple Physically Based
Blinn-Phong Model in Real-Time," 2012. </a></p>
<p><a name="ref24">[24] M. Oren and S. K. Nayar, "Generalization of
Lambert's reflectance model," in Proceedings of the 21st annual
conference on Computer graphics and interactive techniques, 1994.
</a></p>
<p><a name="ref25">[25] S. Lagarde and C. de Rousiers, "Moving Frostbite
to Physically Based Rendering," 2014. </a></p>
<p><a name="ref26">[26] M. Pharr, W. Jakob and G. Humphreys, Physically
based rendering: From theory to implementation, Morgan Kaufmann, 2016.
</a></p>
<p><a name="ref27">[27] P. Hanrahan and W. Krueger, "Reflection from
layered surfaces due to subsurface scattering," in Proceedings of the
20th annual conference on Computer graphics and interactive techniques,
1993. </a></p>
<p><a name="ref28">[28] E. Heitz and J. Dupuy, "Implementing a Simple
Anisotropic Rough Diffuse Material with Stochastic Evaluation," 2015.
</a></p>
<p><a name="ref29">[29] Y. Gotanda, "Designing Reflectance Models for
New Consoles," 2014. </a></p>
<p><a name="ref30">[30] R. L. Cook and K. E. Torrance, "A reflectance
model for computer graphics," ACM Transactions on Graphics, 1982.
</a></p>
<p><a name="ref31">[31] K. E. Torrance and E. M. Sparrow, "Theory for
off-specular reflection from roughened surfaces," Josa, 1967. </a></p>
<p><a name="ref32">[32] B. Walter, S. R. Marschner, H. Li and K. E.
Torrance, "Microfacet Models for Refraction through Rough Surfaces,"
Rendering techniques, 2007. </a></p>
<p><a name="ref33">[33] T. S. Trowbridge and K. P. Reitz, "Average
irregularity representation of a rough surface for ray reflection,"
JOSA, 1975. </a></p>
<p><a name="ref34">[34] C. Hery and R. Villemin, "Physically Based
Lighting at Pixar," 2013. </a></p>
<p><a name="ref35">[35] N. Hoffman, "Background: Physics and Math of
Shading," 2012. </a></p>
<p><a name="ref36">[36] B. Smith, "Geometrical shadowing of a random
rough surface," IEEE Trans. on Antennas and Propagation, 1967. </a></p>
<p><a name="ref37">[37] E. Heitz, "Understanding the Masking-Shadowing
Function in Microfacet-Based BRDFs," 2014. </a></p>
<p><a name="ref38">[38] G. Brown, "Shadowing by non-Gaussian random
surfaces," IEEE Transactions on Antennas and Propagation, 1980. </a></p>
<p><a name="ref39">[39] C. Schlick, "An inexpensive BRDF model for
physically-based rendering," Computer graphics forum, 1994. </a></p>
<p><a name="ref40">[40] E. J. Hammon, "PBR Diffuse Lighting for
GGX+Smith Microsurfaces," GDC, 2005.</a></p>
<p><a name="ref41">[41] E. Heitz and E. d'Eon, "Importance sampling
microfacet-based BSDFs using the distribution of visible normals,"
Computer Graphics Forum, 2014. </a></p>
<p><a name="ref42">[42] E. Heitz, J. Hanika, E. d'Eon and C.
Dachsbacher, "Multiple-scattering microfacet BSDFs with the Smith
model," ACM Transactions on Graphics (TOG), 2016. </a></p>
<p><a name="ref43">[43] E. d’Eon, A Hitchhiker’s Guide to Multiple
Scattering, 2016. </a></p>
<p><a name="ref44">[44] C. Kulla and A. Conty, "Revisiting Physically
Based Shading at Imageworks," 2017. </a></p>
<p><a name="ref45">[45] T. Akenine-Möller, E. Haines, N. Hoffman, A.
Pesce, M. Iwanicki and S. Hillaire, Real-time Rendering, CRC Press,
2019. </a></p>
<p><a name="ref46">[46] G. J. Ward, "Measuring and modeling anisotropic
reflection," 1992. </a></p>
<p><a name="ref47">[47] W. Jakob, E. d'Eon, O. Jakob and S. Marschner,
"A comprehensive framework for rendering layered materials," 2014.
</a></p>
<p><a name="ref48">[48] A. Weidlich and A. Wilkie, "Arbitrarily layered
micro-facet surfaces," in Proceedings of the 5th international
conference on Computer graphics and interactive techniques in Australia
and Southeast Asia, 2007.</a></p>
<p><a name="ref49">[49] L. Belcour and P. Barla, "A Practical Extension
to Microfacet Theory for the Modeling of Varying Iridescence," 2017.
</a></p>
<p><a name="ref50">[50] N. Hoffman, "Fresnel Equations Considered
Harmful," 2019. </a></p>
<p><a name="ref51">[51] M. Mojzík, T. Skřivan, A. Wilkie and J.
Křivánek, "Bi-directional Polarised Light Transport," EGSR, 2016.
</a></p>
<p><a name="ref52">[52] P. S. Strauss, "A realistic lighting model for
computer animators," IEEE Computer Graphics and Applications, 1990.
</a></p>
<p><a name="ref53">[53] B. Smith, "Reflection Model Design for WALL-E
and Up," 2012. </a></p>
<p><a name="ref54">[54] Allegorithmic, "The PBR guide by Allegorithmic,"
2018. [Online]. Available:
https://academy.substance3d.com/courses/the-pbr-guide-part-2. </a></p>
<p><a name="ref55">[55] O. Gulbrandsen, "Artist friendly metallic
fresnel," Journal of Computer Graphics Techniques, 2014. </a></p>
<p><a name="ref56">[56] I. Lazániy and L. Szirmay-Kalos, "Fresnel term
approximations for metals," 2005. </a></p>
<p><a name="ref57">[57] N. Hoffman, "Fresnel Equations Considered
Harmful (slides)," 2019. [Online]. Available:
http://renderwonk.com/publications/mam2019/naty_mam2019.pdf. </a></p>
<p><a name="ref58">[58] M. Polyanskiy, "Refractive index database,"
[Online]. Available: refractiveindex.info. </a></p>
<p><a name="ref59">[59] S. Lagarde, "Spherical Gaussian approximation
for Blinn-Phong, Phong and Fresnel," 2012. [Online]. Available:
https://seblagarde.wordpress.com/2012/06/03/spherical-gaussienapproximation-for-blinn-phong-phong-and-fresnel/.
</a></p>
<p><a name="ref60">[60] C. Schüler, "An efficient and Physically
Plausible Real Time Shading Model," in ShaderX7, 2009. </a></p>
<p><a name="ref61">[61] N. Hoffman, "Crafting Physically Motivated
Shading Models for Game Development," 2010. </a></p>
<p><a name="ref62">[62] E. Heitz, "Sampling the GGX distribution of
visible normals," Journal of Computer Graphics Techniques, 2018.
</a></p>
<p><a name="ref63">[63] W. Jakob, "An Improved Visible Normal Sampling,"
2014. </a></p>
<p><a name="ref64">[64] C. Kelemen and L. Szirmay-Kalos, "A microfacet
based coupled specular-matte BRDF model with importance sampling," 2001.
</a></p>
<p><a name="ref65">[65] M. Drobot and A. Micciulla, "Practical
Multilayered Materials - Call of Duty Infinite Warfare," in SIGGRAPH,
2017. </a></p>
<p><a name="ref66">[66] B. Burley, "Disney BRDF Explorer Github
repository," 2012. [Online]. Available: https://github.com/wdas/brdf.
</a></p>
<p><a name="ref67">[67] D. Lazarov, "Physically Based Lighting in Call
of Duty: Black Ops," 2011. </a></p>
<p><a name="ref68">[68] A. Langlands, "Physically Based Shader Design in
Arnold," 2014. </a></p>
<p><a name="ref69">[69] M. McGuire, J. Dorsey, E. Haines, J. F. Hughes,
S. Marschner, M. Pharr and P. Shirley, "A Taxonomy of Bidirectional
Scattering Distribution Function Lobes for Rendering Engineers," in
Workshop on Material Appearance Modeling, 2020. </a></p>
<p><a name="ref70">[70] J. Hasenjager, "Material Studies: Metals," 2016.
[Online]. Available:
https://www.behance.net/gallery/35636521/Material-Studies-Metals.
</a></p>
<p><a name="ref71">[71] E. Heitz, "Generating Procedural Beckmann
Surfaces," 2015. </a></p>
<p><a name="ref72">[72] M. McGuire, "Tweet #1174191724694032387," 2019.
[Online]. Available:
https://twitter.com/CasualEffects/status/1174191724694032387. </a></p>
<p><a name="ref73">[73] P. Shirley, Ray Tracing in One Weekend,
2018.</a></p>
<section class="footnotes">
<div class="footnote-list">
<ol>
<li>
<span id="fn:1"
class="footnote-text"><span>但是Heitz发表了一篇有趣的论文，该论文以程序方式生成Beckmann分布表面的网格以用于研究目的<sup><a class=n href="#ref71">[71]</a></sup>
<a href="#fnref:1" rev="footnote" class="footnote-backref">
↩︎</a></span></span>
</li>
<li>
<span id="fn:2" class="footnote-text"><span>GG-X可能是“Ground Glass -
roughness
unknown”的缩写<sup><a class=n href="#ref72">[72]</a></sup>，以用于光学测量的抛光至一定粗糙度的磨砂玻璃板命名。
<a href="#fnref:2" rev="footnote" class="footnote-backref">
↩︎</a></span></span>
</li>
</ol>
</div>
</section>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/Article/" class="category-chain-item">Article</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/CG/">#CG</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>Crash Course in BRDF Implementation【译】</div>
      <div>https://reddish.fun/posts/Article/Crash-Course-in-BRDF-Implementation-translation/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>bit704</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2024年1月12日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/posts/Article/CPP-Coroutine/" title="C++协程">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">C++协程</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/posts/Log/question/" title="计算机相关Q&amp;A集锦">
                        <span class="hidden-mobile">计算机相关Q&amp;A集锦</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  


  
  









    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> <br> 欢迎光临 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        总访问量 
        <span id="busuanzi_value_site_pv"></span>
         次
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        总访客数 
        <span id="busuanzi_value_site_uv"></span>
         人
      </span>
    
    
  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  
      <script>
        if (!window.MathJax) {
          window.MathJax = {
            tex    : {
              inlineMath: { '[+]': [['$', '$']] }
            },
            loader : {
              load: ['ui/lazy']
            },
            options: {
              renderActions: {
                insertedScript: [200, () => {
                  document.querySelectorAll('mjx-container').forEach(node => {
                    let target = node.parentNode;
                    if (target.nodeName.toLowerCase() === 'li') {
                      target.parentNode.classList.add('has-jax');
                    }
                  });
                }, '', false]
              }
            }
          };
        } else {
          MathJax.startup.document.state(0);
          MathJax.texReset();
          MathJax.typeset();
          MathJax.typesetPromise();
        }

        Fluid.events.registerRefreshCallback(function() {
          if ('MathJax' in window && MathJax.startup.document && typeof MathJax.startup.document.state === 'function') {
            MathJax.startup.document.state(0);
            MathJax.texReset();
            MathJax.typeset();
            MathJax.typesetPromise();
          }
        });
      </script>
    

  <script  src="https://lib.baomitu.com/mathjax/3.2.2/es5/tex-mml-chtml.js" ></script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>
